\AgdaHide{
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.Fix}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Prelude}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Presheaves.Presheaves}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.Structure}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.Later}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.LaterType}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.FunctionType}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{PSh}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{►Obj}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{ExpObj}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{NatTrans}\<%
\end{code}
}
We omit the semantic equivalents of the terms \IC{next} and \IC{⊛}.
Instead, we describe the fixed point combinator \F{fix}.
For that, we first define a delayed fixed point combinator \F{dfix}, which takes an element of \F{Tm} \Ar{Γ} (\F{►} \Ar{A} \F{⇒} \Ar{A}) and returns an element of \F{Tm} \Ar{Γ} (\F{►} \Ar{A}).
The field \Fi{nat-map} of \F{dfix} \Ar{Γ A f} depends on an auxiliary term \F{dfix₁}, which for a given size \Ar{i}, takes a function \Ar{f} in \F{ExpObj} (\F{►} \Ar{A}) \Ar{A i} and returns an element of \F{►Obj} \Ar{A i}.

To define the \Fi{►cone} field of \F{dfix₁} \Ar{A i f}, we have an inhabitant of \F{SizeLt} \Ar{i}.
By pattern matching we get a size \Ar{j} : \F{Size<} \Ar{i}.
Note that \AFi{fun} \Ar{f} \Ar{j} is a function from \F{►Obj} \AB{A} \AB{j} to \AFi{Obj} \AB{A} \AB{j}, so it suffices to define an inhabitant of type \F{►Obj} \AB{A} \AB{j}.
For this, we use \F{dix₁} \AB{A} \AB{j} \AB{f}.

The termination of this recursive definition is ensured by the usage of \F{SizeLt} \Ar{i} in the definition of \F{Later} \Ar{A i}.
If we used \F{Size<} \Ar{i} instead, which results in the same definition but without the need for pattern matching, we would have constructed a non-productive recursive definition that would have been correcly rejected by Agda's termination checker.
The use of \F{SizeLt} is therefore crucial in the definition of \F{dfix₁} since it prevents indefinite unfolding.
We omit the construction of the \Fi{►com} component of \F{dfix₁} \Ar{A i f}, which also requires the usage of \F{elimLt} for acceptance by the termination checker.
We also omit the definition of the \Fi{nat-com} component of \F{dfix} \Ar{Γ A f}.
\begin{code}%
\>[0]\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Ty}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Size}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{ExpObj}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{►Obj}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
\>[0]\AgdaField{►cone}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[}}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}
\AgdaHide{
\begin{code}%
\>[0]\AgdaField{►com}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[}}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{Mor}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaField{funcom}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►Mor}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►eq}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{\}))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}
}
\begin{code}%
\>[0]\AgdaFunction{dfix}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Ctx}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Ty}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Tm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Tm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{nat{-}map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{nat{-}map}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSymbol{)}\<%
\end{code}
\AgdaHide{
\begin{code}%
\>[0]\AgdaField{nat{-}com}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{►eq}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{nat{-}com}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSymbol{)\})}\<%
\end{code}
}
The semantic fixed point operation is obtained by applying the
function \AB{f} to \F{dfix} \Ar{Γ A f}.
\begin{code}%
\>[0]\AgdaFunction{sem{-}fix}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Ctx}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Ty}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Tm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Tm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>[0]\AgdaFunction{sem{-}fix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sem{-}app{-}map}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dfix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}
}
