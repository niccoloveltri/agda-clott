\AgdaHide{
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.Fix}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Prelude}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Presheaves.Presheaves}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.Structure}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.Later}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.LaterType}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{CloTT.TypeFormers.FunctionType}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{PSh}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{►Obj}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{ExpObj}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{NatTrans}\<%
\end{code}
}
We omit the semantic equivalents of \IC{next} and \IC{⊛}.
To interpret the delayed fixpoint combinator \AIC{dfix}, we introduce an auxiliary term \F{sem-dfix₁}, for which we only show how to construct the field \Fi{►cone}.
This is defined using self-application.
%This is intuitively defined as self-application of the function argument \Ar{f}.
\begin{code}%
\>[0]\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SemTy}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Size}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{ExpObj}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{►Obj}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
\>[0]\AgdaField{►cone}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[}}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}
\AgdaHide{
\begin{code}%
\>[0]\AgdaField{►com}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[}}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{Mor}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaField{funcom}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►Mor}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►eq}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{\}))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}
}
This definition is accepted by Agda's termination checker for two reasons:
\begin{itemize}
  \item every recursive call is applied to a strictly smaller size;
  \item the usage of \F{SizeLt} in place of \F{Size<} in the definition of \F{Later} prevents indefinite unfolding, which would have happened if we used \F{►ObjTry} instead of \F{►Obj}.
\end{itemize}
In fact, if we would replace \F{►Obj} by \F{►ObjTry} as the return type of \F{sem-dfix₁} while keeping the same definition (with \Ar{j} in place of \IC{[} \Ar{j} \IC{]}), we would obtain the following non-terminating sequence of reductions:
\begin{align*}
& \text{\Fi{►cone} (\F{sem-dfix₁} \Ar{A i f})} \\
& \qquad = \text{λ \Ar{j} → \Fi{fun} \Ar{f j} (\F{sem-dfix₁} \Ar{A j f})} \\
& \qquad = \text{λ \Ar{j} → \Fi{fun} \Ar{f j} (\AgdaRecord{record} \{ \Fi{►cone} = λ \Ar{k} → \Fi{fun} \Ar{f k} (\F{sem-dfix₁} \Ar{A k f}) ; \Fi{►com} = \dots \})} \\
& \qquad =  \dots
\end{align*}

\remove{
This definition is accepted by Agda's termination checker because
every recursive call is applied to a strictly smaller size.  Moreover,
the usage of \F{SizeLt} in the definition of \F{Later} prevents the definition from unfolding indefinitely, which would have happened by using \F{►ObjTry} instead of \F{►Obj}.
%, the field \AFi{►cone}
%would have
%been defined by lambda abstraction meaning that we could
%unfolded indefinitely.
This is a non-terminating recursive definition, which Agda would have rightly rejected.
}
The termination of the \Fi{►com} component of \F{sem-dfix₁} additionally relies on the presence of \F{elimLt} in the definition of \F{LaterLim}.

%%Note the recursive call of \F{sem-dfix₁}.
%%The termination is guaranteed by the usage of \F{SizeLt} \Ar{i} in the definition of \F{Later} \Ar{A i}.
%%The foremost reason is that the sizes decrease in every recursive call.
%%In addition, the usage of \F{SizeLt} prevents infinite unfolding.
%%If we used the same definition but with \F{Size<} \Ar{i} instead, we would have constructed a non-productive recursive definition that would have been correcly rejected by Agda's termination checker.

The field \Fi{nat-map} of \F{sem-dfix} is defined using \F{sem-dfix₁}. We omit the
%construction of the
\Fi{nat-com} component.
\begin{code}%
\>[0]\AgdaFunction{sem{-}dfix}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SemCtx}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SemTy}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SemTm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{SemTm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{nat{-}map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{nat{-}map}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSymbol{)}\<%
\end{code}
\AgdaHide{
\begin{code}%
\>[0]\AgdaField{nat{-}com}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{►eq}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fun}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix₁}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{nat{-}com}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{γ}\AgdaSymbol{)\})}\<%
\end{code}
}
\AgdaHide{
\begin{code}%
\>[0]\AgdaFunction{sem{-}fix}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SemCtx}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SemTy}\AgdaSpace{}%
\AgdaInductiveConstructor{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SemTm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{SemTm}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\AgdaFunction{sem{-}fix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sem{-}app{-}map}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{►}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sem{-}dfix}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}
}
